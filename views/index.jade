extends layout

block content
  if curSession
    script(type='text/javascript').
      window._sbSession=!{JSON.stringify(curSession)}
  div(data-ng-hide='appInitialized') - LOADING -
  .container(data-ng-show='appInitialized', data-ng-controller='ErrorsCtrl')
    .row.route-error(data-ng-show='!!routeError') {{ routeError }} 
      a(href='', data-ng-click='clearRouteError()') (x)
    nav.row
      .logo.col-3
        a(href='/') ShieldBattery
      .col-2
        a(href='/lobbies') Play
      .col-2
        a(href='/') Chat
      .col-2
        a(href='/') Watch
      .col-1
        a(href='/settings') Configure
      .col-1(data-ng-controller='LoggerCtrl', data-ng-show='showLogsButton()')
        button(data-ng-click='toggleLogs()') Logs
        .logs(data-ng-show='showLogs')
          button(data-ng-click='clearLogs()') Clear
          input(type='search', data-ng-model='search', placeholder='filter messages...')
          div(data-ng-repeat='message in logger.logs | filter:search')
            span Message &#35;{{ $index + 1 }}
            div(data-ng-repeat='(key, value) in message.message', data-ng-class="(message.source == 'siteSocket') ? 'site-socket-logs' : 'psi-socket-logs'")
              span {{ key }}: {{ value }}
              br
    .row
      .col-3.left-nav(data-ng-controller='StatusCtrl')
        ul(data-ng-hide='siteSocket.connected && psiSocket.connected')
          li(data-ng-show='!siteSocket.connected') Site socket not connected!
          li(data-ng-show='!psiSocket.connected') Psi socket not connected! 
            a(href='', data-ng-click='retryPsi()') (retry)
        .profile
          span(data-ng-show='auth.isLoggedIn')
            p Logged in as {{ auth.user.name }}
            p(data-ng-show='showAdminLink()')
              a(href='/admin') Admin
            p
              a(href='', data-ng-click='logOut()') Log out
          span(data-ng-hide='auth.isLoggedIn')
            a(href='/login') Log in
        .game-status(data-ng-show='joinedLobby.inLobby')
          .nav-section-header Game
          ul
            li {{ joinedLobby.lobby.name }} 
              a(href='', data-ng-click='leaveLobby()') (x)
      main.col-9(ng-view)
